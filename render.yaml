# Render Blueprint for Banking System POC
# This file defines all services for the banking system
# Deploy with: Connect GitHub repo to Render and use Blueprint

databases:
  - name: banking-postgres
    plan: free
    databaseName: corebankdb
    user: bankuser
    region: oregon

services:
  # System 2 - Core Banking Service (Deploy this FIRST)
  - type: web
    name: system2-corebank
    runtime: docker
    dockerfilePath: ./system2-corebank/Dockerfile
    dockerContext: ./system2-corebank
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: DATABASE_URL
        fromDatabase:
          name: banking-postgres
          property: connectionString
      - key: DATABASE_USERNAME
        fromDatabase:
          name: banking-postgres
          property: user
      - key: DATABASE_PASSWORD
        fromDatabase:
          name: banking-postgres
          property: password
      - key: CORS_ORIGINS
        value: "*"
      - key: AES_SECRET_KEY
        generateValue: true

  # System 1 - Gateway Service (Deploy SECOND)
  - type: web
    name: system1-gateway
    runtime: docker
    dockerfilePath: ./system1-gateway/Dockerfile
    dockerContext: ./system1-gateway
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: SYSTEM2_URL
        fromService:
          type: web
          name: system2-corebank
          property: hostport
      - key: CORS_ORIGINS
        value: "*"

  # Banking UI - React Frontend (Static Site - Deploy LAST)
  - type: web
    name: banking-ui
    runtime: static
    rootDir: ./banking-ui
    buildCommand: npm install && npm run build
    staticPublishPath: ./dist
    headers:
      - path: /*
        name: Cache-Control
        value: no-cache
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_GATEWAY_URL
        fromService:
          type: web
          name: system1-gateway
          property: host
      - key: VITE_CORE_URL
        fromService:
          type: web
          name: system2-corebank
          property: host
